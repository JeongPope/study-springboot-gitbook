# WEEK 5

#### IoC, Inversion of Control

기존에는 클라이언트 구현 객체가 스스로 필요한 서버 구현 객체를 직접 생성, 연결, 실행했다. 이 말은 객체가 애플리케이션의 흐름을 제어하게됨을 말한다.

객체가 흐름을 제어하지 않고 자신이 가진 로직을 실행하는 역할만 하게끔하고, 이외의 역할을 위해 필요한 객체들을 외부에서 관리해 그 의존성을 가져오도록 하는것을 말한다.

애플리케이션의 컨텍스트에 대한 것을 관리하는 주체를 IoC 컨테이너(최근에는 DI Container라고 한다고 함)라 하고, 이 컨테이너에서 관리되는 객체들을 Bean이라 부른다. 스프링 프레임워크는 DI Container를 통해 Bean들의 의존성을 관리한다.



**DI, Dependency Injection**

객체가 그 역할을 하기위해 필요한 객체와 의존관계를 맺게되는데, 요구되는 객체를 IoC 컨테이너로부터 받아오는 것을 말한다.



**Spring AOP (Aspect Oriented Programming)**

다수의 모듈에서 공통적으로 사용하는 기능이 존재할 수 있다. (ex. Logging, Security, …) 이러한 공통 기능을 하나의 관점으로 보고, 이를 분리하여 관리하기 위한 방법을 말한다.



**PSA, Portable Service Abstraction**

스프링에서 제공하는 여러 기술들을 추상화해, 개발자가 쉽게 사용하는 인터페이스를 말한다. 가장 널리 알려진 예로, 스프링에서 데이터베이스 활용 기술로는 JDBC, JPA 등 여러 기술이 있는데, 어떤 기술을 사용하더라도 일관된 방식으로 활용가능한 인터페이스를 제공한다.



**Spring Bean**

1.  BeanFactory

    스프링 컨테이너의 최상위 인터페이스이며, 스프링 빈을 관리하고 조회하는 역할을 한다.
2.  ApplicationContext

    BeanFactory를 상속받아 그 기능을 모두 제공한다. 또 다른 여러 인터페이스를 상속받아 여러 기능들을 제공한다.

**Bean 조회**

* ac.getBean(Bean name, Type)
* ac.getBean(Type)
* 조회 대상이 없는 경우 예외가 발생한다.
* Type 조회시 같은 타입의 빈이 두개 이상이면 오류가 발생하므로 빈 이름을 지정한다.

**Bean 상속관계 조회**

* 부모 타입을 조회하게 되는 경우 아래 자식타입도 모두 조회한다.
* 모든 자바 객체의 Root object인 Object 를 검색하면 모든 빈을 조회하게 된다.

**BeanDefinition**

ApplicationContext를 구현하는 AnnotationConfigApplicationContext는 AnnotatedBeanDefinitionReader 를 사용해서 AppConfig.class 를 읽고 BeanDefinition 을 생성한다.

**V 모델**

V모델은 [폭포수 모델](https://velog.io/@whitebear/%ED%8F%AD%ED%8F%AC%EC%88%98-%EB%AA%A8%EB%8D%B8%EC%9D%84-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90)의 변형이다. 폭포수 모델에서 `테스트 단계`를 중점적으로 추가한 모델이다. 폭포수 모델은 `문서 중심`인 반면, V모델은 `각 개발 단계를 검증`하는데 초점을 둔다.

**단위 테스트**

이 테스트의 목표는 `개별 모듈 검증`에 초점이 맞춰져 있다. 여기서 모듈이란 `함수`, `서브루틴`, `컴포넌트` 등을 말한다. 이 테스트에서는 내부의 `논리적 오류`를 검출하고, 사용자 `요구사항`대로 구현되었는지 확인한다.

**통합 테스트**

이 테스트의 목표는 `모듈 간의 인터페이스`를 확인하기 위한 것이다. 다시 말해, 모듈들이 상호 간에 잘 결합되었는지 확인하는 단계이다.

**시스템 테스트**

이 테스트는 모듈이 통합된 후, `사용자의 요구사항을 만족`하는지 확인하는 테스트다. 여기서는 시스템 전체가 `정상적으로 작동하는지 테스트`한다.

**인수 테스트**

인수 테스트(Acceptance Test)는 `시스템이 예상대로 동작`하고 `요구사항에 부합`하는지 확인하는 테스트이다. `요구분석명세서`에 명시된 사항을 모두 충족하는지 테스트한다. 이 단계가 끝나면 프로젝트 수행을 종료한다.

**JUnit**

JUnit은 자바에서 동작하는 수많은 테스트 라이브러리 중 하나이다. 이름을 봐서는 유닛(모듈 혹은 단위) 테스트 전용일 것 같지만 실제로는 통합 테스트, 시스템 테스트, UI 테스트 등 모든 수준의 테스트를 만들 수 있다.

* **Unit test (단위테스트)** : 함수 하나하나와 같이 코드의 작은 부분을 테스트 하는 것
* **Integration test (통합테스트)** : 서로 다른 시스템들의 상호작용이 잘 이뤄지는지 테스트하는 것
* **e2e test (종단 간 테스트)** : 사용자와 어플리케이션의 상호작용이 잘 이뤄지는지 테스트하는 것
* **TDD (Test-driven development)** : 테스트가 주가 되어 개발하는 방법

Spring Test

테스트를 작성할 때, 여러 객체들이 의존성을 갖는 경우 테스트 하기 까다로운 경우가 있다. 예를들어 테스트 대상이 아닌 의존 대상의 결함으로 테스트가 실패하는 경우가 발생할 수 있다. 의존 대상으로 인해 테스트가 실패하는 것을 막기 위해 의존 대상 대신 **실제 동작하는 것 처럼 보이는 별개의 객체**를 만드는 것을 고려할 수 있을 것 이다. 이 방식을 **Solitary Test** 라고 하며, 이때 만드는 별개의 객체를 **테스트 더블 (Test Double)** 이라고 한다.



@MockBean

* 기존에 사용되던 스프링 Bean이 아닌 MockBean을 주입한다.
* 기본적으로 Bean의 실제 구현이 아닌 모든 메서드를 Mocking한다.
* 상태가 없거나, 전체 빈을 대상으로할때 유용하다.



@SpyBean

* 실제 객체를 생성하고, 필요한 경우에만 특정 메서드를 Mocking한다.
* Mocking하지 않은 메서드를 호출하는 경우, 실제 구현된 동작을 한다.
* 상태를 가진 빈에 유용하며, 일부만을 대상으로할때 유용하다.



@MockMvc

개발한 웹 프로그램을 실제 서버에 배포하지 않고도 테스트를 위한 요청을 제공하는 수단으로, REST API의 요청을 만들어 보낼수있다.

* 통합테스트를 실행하지 않고도 컨트롤러 동작을 확인할 수 있다.
* 컨트롤러의 엔드포인트를 호출하여 HTTP 클라이언트의 요청을 모방하고 적절한 응답을 확인하기 위해 테스트를 수행한다.
* 이러한 테스트 과정을 통해 애플리케이션의 서비스 로직이나 API 엔드포인트가 의도한 대로 동작하는지 확인하고, 버그를 발견하고 수정하는 데 유용하다



@WebMvcTest

Web Layer 관련 Bean만 컨테이너에 등록하므로 테스트 수행시간이 SpringBootTest에 비해서 짧다. 통합 테스트에서 테스트가 어려운 작은 단위 테스트들을 WebMvcTest로 진행할 수 있다. Component는 주입되지 않으므로 MockBean으로 등록해야한다.&#x20;

